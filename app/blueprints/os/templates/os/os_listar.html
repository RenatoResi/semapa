{% extends "base.html" %}

{% block title %}Ordens de Serviço - Sistema SEMAPA{% endblock %}

{% block content %}
<h1>Ordens de Serviço</h1>

<section>
    <div style="margin-bottom: 20px;">
        <input type="text" id="filtro-os" placeholder="Buscar OS..." style="padding: 8px; width: 300px;">
        <button onclick="filtrarOS()" style="padding: 8px 15px;">Filtrar</button>
    </div>
    
    <table id="ordens-servico-lista" class="tabela-os">
        <thead>
            <tr>
                <th>Número</th>
                <th>Responsável</th>
                <th>Data Emissão</th>
                <th>Status</th>
                <th>Qtd. Requerimentos</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<section id="detalhes-os" style="display: none; margin-top: 30px;">
    <h2>Detalhes da Ordem de Serviço</h2>
    <div class="detalhes-container">
        <div class="info-os" id="info-os-container">
            <h3>Informações Gerais</h3>
            <div id="info-readonly">
                <p><strong>Número:</strong> <span id="os-numero"></span></p>
                <p><strong>Responsável:</strong> <span id="os-responsavel"></span></p>
                <p><strong>Data Emissão:</strong> <span id="os-emissao"></span></p>
                <p><strong>Data Execução:</strong> <span id="os-execucao"></span></p>
                <p><strong>Status:</strong> <span id="os-status"></span></p>
                <p><strong>Observação:</strong> <span id="os-observacao"></span></p>
                <button id="btn-editar-os" class="btn-editar">Editar OS</button>
            </div>
            
            <div id="info-edit" style="display: none;">
                <p><strong>Número:</strong> <span id="os-numero-edit"></span></p>
                <div class="campo-edicao">
                    <label><strong>Responsável:</strong></label>
                    <input type="text" id="input-responsavel" class="input-edit">
                </div>
                <p><strong>Data Emissão:</strong> <span id="os-emissao-edit"></span></p>
                <div class="campo-edicao">
                    <label><strong>Data Execução:</strong></label>
                    <input type="date" id="input-data-execucao" class="input-edit">
                </div>
                <div class="campo-edicao">
                    <label><strong>Status:</strong></label>
                    <select id="input-status" class="input-edit">
                        <option value="Aberta">Aberta</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Concluída">Concluída</option>
                        <option value="Cancelada">Cancelada</option>
                    </select>
                </div>
                <div class="campo-edicao">
                    <label><strong>Observação:</strong></label>
                    <textarea id="input-observacao" class="input-edit" rows="3"></textarea>
                </div>
                <div class="botoes-edicao">
                    <button id="btn-salvar-os" class="btn-salvar">Salvar</button>
                    <button id="btn-cancelar-os" class="btn-cancelar">Cancelar</button>
                </div>
            </div>
        </div>
        
        <div class="requerimentos-container">
            <h3>Requerimentos Associados</h3>
            <table id="requerimentos-os" class="tabela-requerimentos">
                <thead>
                    <tr>
                        <th>Número</th>
                        <th>Tipo</th>
                        <th>Motivo</th>
                        <th>Requerente</th>
                        <th>Telefone</th>
                        <th>Endereço</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <div class="mapa-container">
        <h3>Localização dos Requerimentos</h3>
        <div id="mapa-os" style="height: 400px;"></div>
    </div>
</section>

{% endblock %}

{% block styles %}
<style>
    .tabela-os {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    .tabela-os th, .tabela-os td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    .tabela-os th {
        background-color: #217a4b;
        color: white;
    }
    .tabela-os tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    .tabela-os tr:hover {
        background-color: #e9f5ee;
        cursor: pointer;
    }
    .detalhes-container {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    .info-os {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #ddd;
    }
    .tabela-requerimentos {
        width: 100%;
        border-collapse: collapse;
    }
    .tabela-requerimentos th, .tabela-requerimentos td {
        border: 1px solid #ddd;
        padding: 8px;
    }
    .tabela-requerimentos th {
        background-color: #2c3e50;
        color: white;
    }
    .btn-editar {
        background: #3498db;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
    }
    .btn-editar:hover {
        background: #2980b9;
    }
    .campo-edicao {
        margin-bottom: 15px;
    }
    .campo-edicao label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    .input-edit {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }
    .input-edit:focus {
        border-color: #217a4b;
        outline: none;
    }
    .botoes-edicao {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    .btn-salvar {
        background: #27ae60;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn-salvar:hover {
        background: #229954;
    }
    .btn-cancelar {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn-cancelar:hover {
        background: #c0392b;
    }
    .mapa-container {
        margin-top: 20px;
    }
    .btn-concluir {
        background: #27ae60;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn-concluir:hover {
        background: #229954;
    }
    .checked-sign {
        font-size: 1.4em;
        color: #27ae60;
        text-align: center;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
<script src="{{ url_for('static', filename='js/renderer_os_listar.js') }}"></script>
{% endblock %}
