{% extends "base.html" %}

{% block title %}Listar Requerimentos - Sistema SEMAPA{% endblock %}

{% block content %}
<h1>Sistema SEMAPA - Requerimentos</h1>

<section>
    <h2>Listagem de Requerimentos</h2>
    <input type="text" id="filtro-requerimento" placeholder="Buscar requerimentos..." style="margin-bottom: 10px; width: 300px;">
    <table id="requerimentos-lista">
        <thead>
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>NÃºmero</th>
                <th>Tipo</th>
                <th>Motivo</th>
                <th>Prioridade</th>
                <th>Data</th>
                <th>Requerente</th>
                <th>Local</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div id="paginacao-requerimentos" style="margin-top: 20px;"></div>
    <button id="btn-gerar-os">Gerar OS</button>
    <button onclick="window.location.href='os_listar'">Listar OS</button>
</section>

<section>
    <h2>Mapa de Requerimentos</h2>
    <div id="map"></div>
</section>

{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
<script src="{{ url_for('static', filename='js/renderer_requerimento_listar.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const filtroInput = document.getElementById('filtro-requerimento');
    if (filtroInput) {
        filtroInput.addEventListener('input', function(e) {
            const termo = e.target.value.toLowerCase();
            document.querySelectorAll('#requerimentos-lista tbody tr').forEach(tr => {
                const campos = Array.from(tr.children).slice(1);
                const textoLinha = campos.map(td => td.textContent?.toLowerCase() ?? '').join(' ');
                tr.style.display = textoLinha.includes(termo) ? '' : 'none';
            });
        });
    }
});

function criarMarcadorCor(prioridade) {
    const el = document.createElement('div');
    el.style.width = '18px';
    el.style.height = '18px';
    el.style.borderRadius = '50%';
    el.style.border = '2px solid #fff';
    el.style.boxShadow = '0 0 4px #0004';
    if (prioridade === 'urgente') {
        el.style.background = 'red';
    } else if (prioridade === 'alta') {
        el.style.background = 'yellow';
    } else {
        el.style.background = 'green';
    }
    return el;
}
</script>
{% endblock %}
